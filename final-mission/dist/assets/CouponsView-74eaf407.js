import{P as D}from"./PaginationView-82b4b6d5.js";import{M as y}from"./bootstrap-b937ab54.js";import{aB as p,L as u,M as e,aY as d,bm as c,bd as m,b9 as w,X as x,aL as h,F as b,aJ as S,Y as _,an as k}from"./@vue-1e6fac6c.js";import{_ as f}from"./index-118448a2.js";import{D as N}from"./AdminDelDataModal-9dd09668.js";import{g as U,h as V,i as C}from"./admin-api-6c4fbbcb.js";import"./@ckeditor-b907fba5.js";import"./vue-d290faf7.js";import"./axios-aba6f0e0.js";import"./vue-axios-58a7c26f.js";import"./vee-validate-aae8f501.js";import"./@vee-validate-55db0f47.js";import"./vue-router-3222bb99.js";const T={props:["couponSelected","isNewCoupon","saveCoupon"],data(){return{modal:"",tempCoupon:{},due_date:null}},mounted(){this.modal=new y(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},watch:{couponSelected(){this.tempCoupon=this.couponSelected,this.isNewCoupon?this.due_date=null:[this.due_date]=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T")},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},P={class:"modal fade",id:"adminCouponModal",tabindex:"-1",role:"dialog","aria-labelledby":"adminCouponModal",ref:"modal","aria-hidden":"true"},$={class:"modal-dialog modal-dialog-centered modal-lg",role:"document"},L={class:"modal-content"},B={class:"modal-header bg-warning bg-opacity-75"},A={class:"modal-title",id:"modalLabel"},E=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),F={class:"modal-body"},Y={class:"container"},z={class:"row"},I={class:"col-6"},J={class:"mb-3"},O=e("label",{for:"title",class:"form-label"},"優惠名稱",-1),X={class:"mb-3"},j=e("label",{for:"content",class:"form-label"},"優惠說明",-1),q={class:"mb-3"},G=e("label",{for:"due_date",class:"form-label"},"到期日",-1),H={class:"col-6"},K={class:"mb-3"},Q=e("label",{for:"percent",class:"form-label"},[x("優惠折扣百分比"),e("span",{class:"text-secondary"},"（預設為100）")],-1),R={class:"mb-3"},W=e("label",{for:"code",class:"form-label"},"折扣碼",-1),Z={class:"mb-3"},ee={class:"form-check"},te=e("label",{class:"form-check-label",for:"is_enabled"},"是否上架",-1),oe={class:"modal-footer"},se={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"};function ne(s,t,l,r,o,i){return p(),u("div",P,[e("div",$,[e("div",L,[e("div",B,[e("h5",A,d(l.isNewCoupon?"新增優惠券":"編輯優惠券"),1),E]),e("div",F,[e("div",Y,[e("div",z,[e("div",I,[e("div",J,[O,c(e("input",{id:"title","onUpdate:modelValue":t[0]||(t[0]=n=>o.tempCoupon.title=n),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[m,o.tempCoupon.title]])]),e("div",X,[j,c(e("input",{id:"content","onUpdate:modelValue":t[1]||(t[1]=n=>o.tempCoupon.content=n),type:"text",class:"form-control",placeholder:"請輸入說明內容"},null,512),[[m,o.tempCoupon.content]])]),e("div",q,[G,c(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=n=>o.due_date=n)},null,512),[[m,o.due_date]])])]),e("div",H,[e("div",K,[Q,c(e("input",{id:"percent","onUpdate:modelValue":t[3]||(t[3]=n=>o.tempCoupon.percent=n),type:"number",class:"form-control",placeholder:"請輸入折扣百分比",max:"100",min:"0"},null,512),[[m,o.tempCoupon.percent]])]),e("div",R,[W,c(e("input",{id:"code","onUpdate:modelValue":t[4]||(t[4]=n=>o.tempCoupon.code=n),type:"text",class:"form-control",placeholder:"請輸入折扣碼"},null,512),[[m,o.tempCoupon.code]])]),e("div",Z,[e("div",ee,[c(e("input",{id:"is_enabled","onUpdate:modelValue":t[5]||(t[5]=n=>o.tempCoupon.is_enabled=n),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[w,o.tempCoupon.is_enabled]]),te])])])])])]),e("div",oe,[e("button",se,d(l.isNewCoupon?"取消新增":"取消編輯"),1),e("button",{type:"button",class:"btn btn-warning",onClick:t[6]||(t[6]=n=>l.saveCoupon(o.tempCoupon.id))},d(l.isNewCoupon?"新增優惠券":"儲存變更"),1)])])])],512)}const ae=f(T,[["render",ne]]),le={data(){return{couponsData:[],haveCouponsData:!1,pagination:{},currentPage:1,couponSelected:{},isNewCoupon:!0,dataType:"優惠券"}},methods:{getCouponsData(s=1){this.currentPage=s,this.$http.get(U(s)).then(t=>{this.couponsData=t.data.coupons,this.haveCouponsData=this.couponsData.length>0,this.haveCouponsData&&(this.pagination=t.data.pagination,this.couponsData.forEach(l=>{l.dueDate=this.transformTime(l.due_date)}))}).catch(t=>alert(t))},transformTime(s){return new Date(s*1e3).toLocaleString().split(" ")[0]},openManageModal(s,t){s==="add"?(this.isNewCoupon=!0,this.couponSelected={percent:100},this.$refs.couponModal.openModal()):s==="edit"?(this.isNewCoupon=!1,this.couponSelected=t,this.$refs.couponModal.openModal()):s==="del"&&(this.couponSelected=t,this.$refs.delCouponModal.openModal())},saveCoupon(s){const t=this.isNewCoupon?"post":"put",l=this.isNewCoupon?V:C(s);this.$http[t](l,{data:this.couponSelected}).then(r=>{alert(r.data.message),this.$refs.couponModal.hideModal(),this.getCouponsData()}).catch(r=>alert(r.response.data.message))},delCoupon(s){this.$http.delete(C(s)).then(t=>{alert(t.data.message),this.$refs.delCouponModal.hideModal(),this.getCouponsData(this.currentPage)}).catch(t=>alert(t.response.data.message))}},components:{Pagination:D,AdminCouponModal:ae,DelDataModal:N},mounted(){this.getCouponsData()}},de=e("h1",{class:"h3"},"優換券管理",-1),ie={class:"text-end my-4"},ce={key:0},pe={class:"table text-center"},ue=e("thead",null,[e("tr",null,[e("th",null,"序號"),e("th",null,"標題"),e("th",null,"折扣碼"),e("th",null,"折扣比"),e("th",null,"到期日"),e("th",null,"狀態"),e("th")])],-1),re=["onClick"],me=e("i",{class:"bi bi-pen text-secondary fw-light"},null,-1),he=[me],_e=["onClick"],be=e("i",{class:"bi bi-trash3 text-danger fw-light"},null,-1),Ce=[be],fe={key:1},ge=e("p",null,"目前尚未建立優惠券",-1),ve=[ge];function Me(s,t,l,r,o,i){const n=h("Pagination"),g=h("AdminCouponModal"),v=h("DelDataModal");return p(),u(b,null,[de,e("div",ie,[e("button",{type:"button",class:"btn btn-warning",onClick:t[0]||(t[0]=a=>i.openManageModal("add"))}," 新增優惠券 ")]),o.haveCouponsData?(p(),u("div",ce,[e("table",pe,[ue,(p(!0),u(b,null,S(o.couponsData,a=>(p(),u("tbody",{key:a.id,class:"align-middle fs-6"},[e("tr",null,[e("td",null,d(a.num),1),e("td",null,d(a.title),1),e("td",null,d(a.code),1),e("td",null,d(a.percent)+"％",1),e("td",null,d(a.dueDate),1),e("td",{class:k({"text-success":a.is_enabled})},d(a.is_enabled?"啟用":"未啟用"),3),e("td",null,[e("button",{type:"button ",class:"btn btn-sm px-1",onClick:M=>i.openManageModal("edit",a)},he,8,re),e("button",{type:"button ",class:"btn btn-sm px-1",onClick:M=>i.openManageModal("del",a)},Ce,8,_e)])])]))),128))]),_(n,{ref:"pagination",pages:o.pagination,"get-per-page-data":i.getCouponsData},null,8,["pages","get-per-page-data"])])):(p(),u("div",fe,ve)),_(g,{ref:"couponModal","coupon-Selected":o.couponSelected,"is-New-Coupon":o.isNewCoupon,"save-Coupon":i.saveCoupon},null,8,["coupon-Selected","is-New-Coupon","save-Coupon"]),_(v,{ref:"delCouponModal","data-Selected":o.couponSelected,"del-Data":i.delCoupon,"data-Type":o.dataType},null,8,["data-Selected","del-Data","data-Type"])],64)}const Be=f(le,[["render",Me]]);export{Be as default};
