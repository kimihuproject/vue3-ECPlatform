import{P as w}from"./PaginationView-82b4b6d5.js";import{D as M}from"./AdminDelDataModal-9dd09668.js";import{M as D}from"./bootstrap-b937ab54.js";import{a as S}from"./@ckeditor-b907fba5.js";import{aL as b,aB as n,L as r,M as t,aY as p,bm as u,bd as h,F as g,aJ as y,J as _,Y as f,b9 as x,an as C}from"./@vue-1e6fac6c.js";import{_ as U}from"./index-118448a2.js";import{j as V,k as v,b as N,l as I}from"./admin-api-6c4fbbcb.js";import"./vue-d290faf7.js";import"./axios-aba6f0e0.js";import"./vue-axios-58a7c26f.js";import"./vee-validate-aae8f501.js";import"./@vee-validate-55db0f47.js";import"./vue-router-3222bb99.js";const P={props:["articleSelected","isNewArticle","addSideImages","uploadImage","saveArticle"],data(){return{modal:"",tempArticle:{imagesUrl:[],tag:[]},create_at:null,due_date:null,editor:S,editorConfig:{toolbar:["heading","bold","italic","|","link"]}}},mounted(){this.modal=new D(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},watch:{articleSelected(){this.tempArticle=this.articleSelected,this.isNewArticle?(this.due_date=null,this.create_at=null):([this.due_date]=new Date(this.tempArticle.due_date*1e3).toISOString().split("T"),[this.create_at]=new Date(this.tempArticle.create_at*1e3).toISOString().split("T"))},due_date(){this.tempArticle.due_date=Math.floor(new Date(this.due_date)/1e3)},create_at(){this.tempArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}}},T={class:"modal fade",id:"adminArticleModal",tabindex:"-1",role:"dialog","aria-labelledby":"adminArticleModal",ref:"modal","aria-hidden":"true"},L={class:"modal-dialog modal-dialog-centered modal-xl",role:"document"},B={class:"modal-content"},E={class:"modal-header bg-warning bg-opacity-75"},O={class:"modal-title",id:"modalLabel"},F=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},J={class:"row"},Y={class:"col-sm-8",id:"edit-content-from"},z={class:"row"},q={class:"col-md-8"},G={class:"mb-3"},H=t("label",{for:"title",class:"form-label"},"文章標題",-1),K={class:"col-md-4"},Q={class:"mb-3"},R=t("label",{for:"title",class:"form-label"},"撰稿者",-1),W={class:"row"},X={class:"col-md-6"},Z={class:"mb-3"},$=t("label",{for:"create_at"},"建立日期",-1),tt={class:"col-md-6"},et={class:"mb-3"},lt=t("label",{for:"due_date"},"預定下架日期",-1),st={class:"mb-3"},it=t("label",{for:"description",class:"form-label"},"簡述",-1),ot={class:"mb-3"},at=t("label",{for:"tag",class:"form-label"},"標籤",-1),nt={class:"row gx-1 mb-3"},rt={class:"input-group input-group-sm"},ct=["onUpdate:modelValue"],dt=["onClick"],mt=t("i",{class:"bi bi-x"},null,-1),ut=[mt],pt={key:0,class:"col-md-2 mb-1"},ht={class:"mb-3"},_t={class:"mb-3"},gt={class:"form-check"},bt=t("label",{class:"form-check-label",for:"isPublic"},"是否上架",-1),ft={class:"col-sm-4"},At={class:"mb-3"},vt=t("label",{for:"imageUrl ",class:"form-label"},"主圖(請輸入網址或上傳圖片)",-1),yt=["src"],Ut=t("hr",null,null,-1),kt={key:0},wt={class:"mb-3"},Mt=t("label",{for:"imageUrl",class:"form-label"},"副圖網址：",-1),Dt=["onUpdate:modelValue"],St=["src"],xt=["onClick"],Ct=t("hr",null,null,-1),Vt={key:0},Nt={class:"modal-footer"},It={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"};function Pt(o,l,i,d,e,m){const A=b("ckeditor");return n(),r("div",T,[t("div",L,[t("div",B,[t("div",E,[t("h5",O,p(i.isNewArticle?"新增文章":"編輯文章"),1),F]),t("div",j,[t("div",J,[t("div",Y,[t("div",z,[t("div",q,[t("div",G,[H,u(t("input",{id:"title","onUpdate:modelValue":l[0]||(l[0]=s=>e.tempArticle.title=s),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[h,e.tempArticle.title]])])]),t("div",K,[t("div",Q,[R,u(t("input",{id:"title","onUpdate:modelValue":l[1]||(l[1]=s=>e.tempArticle.author=s),type:"text",class:"form-control",placeholder:"請輸入撰稿者"},null,512),[[h,e.tempArticle.author]])])])]),t("div",W,[t("div",X,[t("div",Z,[$,u(t("input",{type:"date",class:"form-control",id:"create_at","onUpdate:modelValue":l[2]||(l[2]=s=>e.create_at=s)},null,512),[[h,e.create_at]])])]),t("div",tt,[t("div",et,[lt,u(t("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":l[3]||(l[3]=s=>e.due_date=s)},null,512),[[h,e.due_date]])])])]),t("div",st,[it,u(t("textarea",{id:"description","onUpdate:modelValue":l[4]||(l[4]=s=>e.tempArticle.description=s),type:"text",class:"form-control",placeholder:"請輸入簡述"},`
                `,512),[[h,e.tempArticle.description]])]),t("div",ot,[at,t("div",nt,[(n(!0),r(g,null,y(e.tempArticle.tag,(s,c)=>(n(),r("div",{class:"col-md-2 mb-1",key:"tag"+c},[t("div",rt,[u(t("input",{type:"text",class:"form-control form-control",id:"tag","onUpdate:modelValue":a=>e.tempArticle.tag[c]=a,placeholder:"請輸入標籤"},null,8,ct),[[h,e.tempArticle.tag[c]]]),t("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>e.tempArticle.tag.splice(c,1)},ut,8,dt)])]))),128)),e.tempArticle.tag[e.tempArticle.tag.length-1]||!e.tempArticle.tag.length?(n(),r("div",pt,[t("button",{class:"btn btn-outline-warning btn-sm d-block w-100",type:"button",onClick:l[5]||(l[5]=s=>e.tempArticle.tag.push(""))}," 新增標籤 ")])):_("",!0)])]),t("div",ht,[f(A,{editor:e.editor,config:e.editorConfig,modelValue:e.tempArticle.content,"onUpdate:modelValue":l[6]||(l[6]=s=>e.tempArticle.content=s)},null,8,["editor","config","modelValue"])]),t("div",_t,[t("div",gt,[u(t("input",{id:"isPublic","onUpdate:modelValue":l[7]||(l[7]=s=>e.tempArticle.isPublic=s),class:"form-check-input",type:"checkbox","true-value":!0,"false-value":!1},null,512),[[x,e.tempArticle.isPublic]]),bt])])]),t("div",ft,[t("div",At,[vt,u(t("input",{"onUpdate:modelValue":l[8]||(l[8]=s=>e.tempArticle.imageUrl=s),type:"text",class:"form-control my-2",placeholder:"請輸入圖片連結"},null,512),[[h,e.tempArticle.imageUrl]]),t("input",{class:"form-control my-2",type:"file",name:"file-to-upload",onChange:l[9]||(l[9]=s=>i.uploadImage(s))},null,32),t("img",{class:"img-fluid rounded",src:e.tempArticle.imageUrl},null,8,yt),e.tempArticle.imageUrl?(n(),r(g,{key:0},[Ut,Object.keys(e.tempArticle).indexOf("imagesUrl")<0||!e.tempArticle.imagesUrl.length?(n(),r("div",kt,[t("button",{class:"btn btn-outline-warning btn-sm d-block w-100 mt-1",onClick:l[10]||(l[10]=(...s)=>i.addSideImages&&i.addSideImages(...s))}," 新增副圖 ")])):_("",!0)],64)):_("",!0)]),Array.isArray(e.tempArticle.imagesUrl)&&e.tempArticle.imagesUrl.length?(n(),r(g,{key:0},[(n(!0),r(g,null,y(e.tempArticle.imagesUrl,(s,c)=>(n(),r("div",{class:"mb-1",key:"sideImage"+c},[t("div",wt,[Mt,u(t("input",{"onUpdate:modelValue":a=>e.tempArticle.imagesUrl[c]=a,type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,8,Dt),[[h,e.tempArticle.imagesUrl[c]]])]),t("img",{class:"img-fluid rounded",src:s},null,8,St),e.tempArticle.imagesUrl[e.tempArticle.imagesUrl.length-1]?(n(),r("button",{key:0,class:"btn btn-outline-danger btn-sm d-block w-100 m-1",onClick:a=>e.tempArticle.imagesUrl.splice(c,1)}," 刪除本張副圖 ",8,xt)):_("",!0),Ct]))),128)),e.tempArticle.imagesUrl[e.tempArticle.imagesUrl.length-1]?(n(),r("div",Vt,[t("button",{class:"btn btn-outline-warning btn-sm d-block w-100 m-1",onClick:l[11]||(l[11]=s=>e.tempArticle.imagesUrl.push(""))}," 新增副圖 ")])):_("",!0)],64)):_("",!0)])])]),t("div",Nt,[t("button",It,p(i.isNewArticle?"取消新增":"取消編輯"),1),t("button",{type:"button",class:"btn btn-warning",onClick:l[12]||(l[12]=s=>i.saveArticle(e.tempArticle))},p(i.isNewArticle?"新增文章":"儲存變更"),1)])])])],512)}const Tt=U(P,[["render",Pt]]),Lt={data(){return{articlesData:[],haveArticlesData:!1,pagination:{},currentPage:1,articleSelected:{imagesUrl:[],tag:[]},isNewArticle:!0,dataType:"文章"}},methods:{getArticlesData(o=1){this.currentPage=o,this.$http.get(V(o)).then(l=>{this.articlesData=l.data.articles,this.haveArticlesData=this.articlesData.length>0,this.haveArticlesData&&(this.pagination=l.data.pagination,this.articlesData.forEach(i=>{i.dueDate=this.transformTime(i.due_date),i.createDate=this.transformTime(i.create_at)}))}).catch(l=>alert(l))},transformTime(o){return new Date(o*1e3).toLocaleString().split(" ")[0]},openManageModal(o,l){o==="add"?(this.isNewArticle=!0,this.articleSelected={imagesUrl:[],tag:[]},this.$refs.articleModal.openModal()):o==="edit"?(this.isNewArticle=!1,this.$http.get(v(l.id)).then(i=>{i.data.success&&(this.articleSelected=i.data.article,this.$refs.articleModal.openModal())}).catch(i=>alert(i.response.data.message))):o==="del"&&(this.articleSelected=l,this.$refs.delArticleModal.openModal())},uploadImage(o){const l=o.target.files[0],i=new FormData;i.append("file-to-upload",l),l&&this.$http.post(N,i).then(d=>{this.articleSelected.imageUrl=d.data.imageUrl}).catch(d=>alert(d.message))},addSideImages(){this.articleSelected.imagesUrl=[],this.articleSelected.imagesUrl.push("")},saveArticle(o){const l=this.isNewArticle?"post":"put",i=this.isNewArticle?I:v(o.id);this.$http[l](i,{data:o}).then(d=>{alert(d.data.message),this.$refs.articleModal.hideModal(),this.getArticlesData()}).catch(d=>alert(d.response.data.message))},delArticle(o){this.$http.delete(v(o)).then(l=>{alert(l.data.message),this.$refs.delArticleModal.hideModal(),this.getArticlesData(this.currentPage)}).catch(l=>alert(l.response.data.message))}},components:{Pagination:w,DelDataModal:M,ArticleModal:Tt},mounted(){this.getArticlesData()}},Bt=t("h1",{class:"h3"},"主題文章管理",-1),Et=t("p",{class:"text-secondary fw-lighter"},"前台顯示：依時而食",-1),Ot={class:"text-end my-4"},Ft={key:0},jt={class:"table text-center"},Jt=t("thead",null,[t("tr",null,[t("th",null,"序號"),t("th",null,"標題"),t("th",null,"建立日期"),t("th",null,"到期日"),t("th",null,"撰稿者"),t("th",null,"狀態"),t("th")])],-1),Yt=["onClick"],zt=t("i",{class:"bi bi-pen text-secondary fw-light"},null,-1),qt=[zt],Gt=["onClick"],Ht=t("i",{class:"bi bi-trash3 text-danger fw-light"},null,-1),Kt=[Ht],Qt={key:1},Rt=t("p",null,"目前尚未建立文章",-1),Wt=[Rt];function Xt(o,l,i,d,e,m){const A=b("Pagination"),s=b("ArticleModal"),c=b("DelDataModal");return n(),r(g,null,[Bt,Et,t("div",Ot,[t("button",{type:"button",class:"btn btn-warning",onClick:l[0]||(l[0]=a=>m.openManageModal("add"))},"新增文章")]),e.haveArticlesData?(n(),r("div",Ft,[t("table",jt,[Jt,(n(!0),r(g,null,y(e.articlesData,a=>(n(),r("tbody",{key:a.id,class:"align-middle fs-6"},[t("tr",null,[t("td",null,p(a.num),1),t("td",null,p(a.title),1),t("td",null,p(a.createDate),1),t("td",null,p(a.dueDate),1),t("td",null,p(a.author),1),t("td",{class:C({"text-success":a.isPublic})},p(a.isPublic?"啟用":"未啟用"),3),t("td",null,[t("button",{type:"button ",class:"btn btn-sm px-1",onClick:k=>m.openManageModal("edit",a)},qt,8,Yt),t("button",{type:"button ",class:"btn btn-sm px-1",onClick:k=>m.openManageModal("del",a)},Kt,8,Gt)])])]))),128))]),f(A,{ref:"pagination",pages:e.pagination,"get-per-page-data":m.getArticlesData},null,8,["pages","get-per-page-data"])])):(n(),r("div",Qt,Wt)),f(s,{ref:"articleModal","article-Selected":e.articleSelected,"is-New-Article":e.isNewArticle,"save-Article":m.saveArticle,"add-side-images":m.addSideImages,"upload-image":m.uploadImage},null,8,["article-Selected","is-New-Article","save-Article","add-side-images","upload-image"]),f(c,{ref:"delArticleModal","data-Selected":e.articleSelected,"del-Data":m.delArticle,"data-Type":e.dataType},null,8,["data-Selected","del-Data","data-Type"])],64)}const me=U(Lt,[["render",Xt]]);export{me as default};
