import{P as w}from"./PaginationView-82b4b6d5.js";import{M as D}from"./bootstrap-b937ab54.js";import{_ as y}from"./index-118448a2.js";import{aB as r,L as i,M as e,aY as s,J as u,bm as O,bc as x,F as m,aJ as v,X as A,b9 as p,aL as b,Y as f,an as S}from"./@vue-1e6fac6c.js";import{o as $,d as g,f as C}from"./admin-api-6c4fbbcb.js";import{o as P}from"./adminFormData-da5bf668.js";import"./@ckeditor-b907fba5.js";import"./vue-d290faf7.js";import"./axios-aba6f0e0.js";import"./vue-axios-58a7c26f.js";import"./vee-validate-aae8f501.js";import"./@vee-validate-55db0f47.js";import"./vue-router-3222bb99.js";const R={props:["isDelAllOrder","orderSelected","delOrder","delAllOrders"],data(){return{modal:""}},mounted(){this.modal=new D(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}}},V={ref:"modal",class:"modal fade",id:"delProductModal",tabindex:"-1","aria-labelledby":"delOrder","aria-hidden":"true"},U={class:"modal-dialog modal-dialog-centered"},L={class:"modal-content"},B={class:"modal-header bg-danger text-light"},E={class:"modal-title",id:"exampleModalLabel"},N=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),T={class:"modal-body"},F={key:0},J=e("h6",null,"確認刪除所有訂單",-1),Y=[J],j={key:1},q={class:"fw-bold"},z={class:"fw-bold"},X={class:"fw-bold"},G={class:"fw-bold"},H=e("strong",{class:"text-danger fs-6"},"＊經刪除後無法復原。",-1),I={class:"modal-footer"},K=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function Q(l,d,t,h,n,c){return r(),i("div",V,[e("div",U,[e("div",L,[e("div",B,[e("h5",E,s(t.isDelAllOrder?"刪除所有訂單":`刪除訂單：${t.orderSelected.id}`),1),N]),e("div",T,[t.isDelAllOrder?(r(),i("div",F,Y)):t.isDelAllOrder?u("",!0):(r(),i("div",j,[e("p",q,"編號："+s(t.orderSelected.id),1),e("p",z,"金額："+s(t.orderSelected.total),1),e("p",X,"日期："+s(t.orderSelected.orderDate),1),e("p",G,"狀態："+s(t.orderSelected.state),1)])),H]),e("div",I,[K,t.isDelAllOrder?(r(),i("button",{key:0,type:"button",class:"btn btn-danger",onClick:d[0]||(d[0]=(...o)=>t.delAllOrders&&t.delAllOrders(...o))}," 確定刪除所有訂單 ")):t.isDelAllOrder?u("",!0):(r(),i("button",{key:1,type:"button",class:"btn btn-danger",onClick:d[1]||(d[1]=o=>t.delOrder(t.orderSelected.id))}," 確定刪除 "))])])])],512)}const W=y(R,[["render",Q]]),Z={props:["orderSelected","saveOrder","orderState"],data(){return{modal:""}},mounted(){this.modal=new D(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}}},ee={class:"modal fade",id:"adminOrderModal",tabindex:"-1",role:"dialog","aria-labelledby":"adminOrderModal",ref:"modal","aria-hidden":"true"},te={class:"modal-dialog modal-dialog-centered modal-lg",role:"document"},de={class:"modal-content"},se=e("div",{class:"modal-header bg-warning bg-opacity-75"},[e("h5",{class:"modal-title",id:"modalLabel"},"編輯訂單"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),le={class:"modal-body"},ae={class:"container"},oe={class:"row"},re={class:"list-unstyled"},ie={class:"my-3"},ne={class:"my-3"},ce={class:"my-3"},he={class:"my-3"},_e={key:0,class:"my-3"},ue={class:"d-flex my-3"},me=e("label",{for:"order-state",class:"form-label"},"訂單狀態：",-1),be=["value"],fe={class:"my-3 d-flex"},ge={class:"form-check"},Oe=e("label",{class:"form-check-label",for:"is_delivery"},"是否出貨",-1),ve=e("hr",null,null,-1),ye={class:"row"},Se={class:"col-6"},De=e("h6",null,"訂購者資訊",-1),pe={class:"card"},Me={class:"card-body"},ke={class:"table align-middle"},we=e("th",{scope:"row"},"姓名",-1),xe=e("th",{scope:"row"},"Email",-1),Ae=e("th",{scope:"row"},"電話",-1),$e=e("th",{scope:"row"},"地址",-1),Ce=e("th",{scope:"row"},"備註",-1),Pe={class:"col-6"},Re=e("h6",null,"訂單商品明細",-1),Ve={class:"card"},Ue={class:"card-body"},Le={class:"table align-middle"},Be=e("thead",null,[e("tr",null,[e("th",null,"品名"),e("th",null,"數量"),e("th",null,"小計")])],-1),Ee={class:"modal-footer"},Ne=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消編輯",-1);function Te(l,d,t,h,n,c){return r(),i("div",ee,[e("div",te,[e("div",de,[se,e("div",le,[e("div",ae,[e("div",oe,[e("ul",re,[e("li",ie,"訂單編號："+s(t.orderSelected.id),1),e("li",ne,"成立時間："+s(t.orderSelected.orderDate),1),e("li",ce,"訂單金額："+s(t.orderSelected.total),1),e("li",he,"付款狀態："+s(t.orderSelected.is_paid?"已付款":"未付款"),1),t.orderSelected.is_paid?(r(),i("li",_e," 付款時間："+s(t.orderSelected.paidDate),1)):u("",!0),e("li",ue,[me,O(e("select",{id:"order-state",class:"form-select w-50","aria-label":"select order-state","onUpdate:modelValue":d[0]||(d[0]=o=>t.orderSelected.state=o)},[(r(!0),i(m,null,v(t.orderState,o=>(r(),i("option",{key:o,value:o},s(o),9,be))),128))],512),[[x,t.orderSelected.state]])]),e("li",fe,[A(" 出貨狀態： "),e("div",ge,[O(e("input",{id:"is_delivery","onUpdate:modelValue":d[1]||(d[1]=o=>t.orderSelected.isDelivery=o),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[p,t.orderSelected.isDelivery]]),Oe])])])]),ve,e("div",ye,[e("div",Se,[De,e("div",pe,[e("div",Me,[e("table",ke,[e("tbody",null,[e("tr",null,[we,e("td",null,s(t.orderSelected.user.name),1)]),e("tr",null,[xe,e("td",null,s(t.orderSelected.user.email),1)]),e("tr",null,[Ae,e("td",null,s(t.orderSelected.user.tel),1)]),e("tr",null,[$e,e("td",null,s(t.orderSelected.user.address),1)]),e("tr",null,[Ce,e("td",null,s(t.orderSelected.user.message?t.orderSelected.user.message:"無備註"),1)])])])])])]),e("div",Pe,[Re,e("div",Ve,[e("div",Ue,[e("table",Le,[Be,e("tbody",null,[(r(!0),i(m,null,v(t.orderSelected.productsData,o=>(r(),i("tr",{key:"orderProducts"+o.id},[e("td",null,s(o.product.title),1),e("td",null,s(o.qty),1),e("td",null,s(o.total),1)]))),128))])])])])])])])]),e("div",Ee,[Ne,e("button",{type:"button",class:"btn btn-warning",onClick:d[2]||(d[2]=o=>t.saveOrder(t.orderSelected.id))}," 儲存變更 ")])])])],512)}const Fe=y(Z,[["render",Te]]),Je={data(){return{ordersData:[],haveOrdersData:!1,pagination:{},currentPage:1,orderState:[],orderSelected:{user:""},isDelAllOrder:!1}},methods:{getOrdersData(l=1){this.currentPage=l,this.$http.get($(l)).then(d=>{this.ordersData=d.data.orders,this.haveOrdersData=this.ordersData.length>0,this.haveOrdersData&&(this.pagination=d.data.pagination,this.ordersData.forEach(t=>{t.orderDate=this.transformTime(t.create_at),t.paid_date&&(t.paidDate=this.transformTime(t.paid_date));const h=[];Object.keys(t.products).forEach(n=>{h.push(t.products[n])}),t.productsData=h,t.state||(t.state=this.orderState[0]),t.isDelivery||(t.isDelivery=!1),t.isRead||(t.isRead=!1)}))}).catch(d=>alert(d))},transformTime(l){return new Date(l*1e3).toLocaleString().split(" ")[0]},toggleOrderIsRead(l){this.orderSelected=l,this.$http.put(g(l.id),{data:this.orderSelected}).then(d=>{this.getOrdersData(this.currentPage)}).catch(d=>alert(d.response.data.message))},openManageModal(l,d){l==="edit"?(this.orderSelected={...d},this.orderSelected.isRead||(this.orderSelected.isRead=!0,this.toggleOrderIsRead(this.orderSelected)),this.$refs.editOrderModal.openModal()):l==="del"?(this.isDelAllOrder=!1,this.orderSelected={...d},this.$refs.delOrderModal.openModal()):l==="delAll"&&(this.isDelAllOrder=!0,this.$refs.delOrderModal.openModal())},saveOrder(l){this.$http.put(g(l),{data:this.orderSelected}).then(d=>{alert(d.data.message),this.$refs.editOrderModal.hideModal(),this.getOrdersData(this.currentPage)}).catch(d=>alert(d.response.data.message))},delOrder(l){this.$http.delete(g(l)).then(d=>{alert(d.data.message),this.$refs.delOrderModal.hideModal(),this.getOrdersData(this.currentPage)}).catch(d=>alert(d.response.data.message))},delAllOrders(){this.$http.delete(C).then(l=>{alert(l.data.message),this.$refs.delOrderModal.hideModal(),this.getOrdersData()}).catch(l=>alert(l.response.data.message))}},components:{Pagination:w,AdminOrderModal:Fe,DelOrderModal:W},mounted(){this.getOrdersData(),this.orderState=P.orderState}},Ye=e("h1",{class:"h3"},"訂單管理",-1),je={key:0},qe={class:"text-end my-4"},ze={class:"table text-center"},Xe=e("thead",null,[e("tr",null,[e("th",null,"序號"),e("th",null,"讀取"),e("th",null,"日期"),e("th",null,"編號"),e("th",null,"金額"),e("th",null,"付款"),e("th",null,"進度"),e("th",null,"出貨"),e("th")])],-1),Ge={class:"form-check form-switch"},He=["id","onUpdate:modelValue","onChange"],Ie=["for"],Ke={key:0},Qe={key:1,class:"text-danger"},We=["onClick"],Ze=e("i",{class:"bi bi-pen text-secondary fw-light"},null,-1),et=[Ze],tt=["onClick"],dt=e("i",{class:"bi bi-trash3 text-danger fw-light"},null,-1),st=[dt],lt={key:1},at=e("p",null,"目前未有任何訂單",-1),ot=[at];function rt(l,d,t,h,n,c){const o=b("Pagination"),M=b("DelOrderModal"),k=b("AdminOrderModal");return r(),i(m,null,[Ye,n.haveOrdersData?(r(),i("div",je,[e("div",qe,[e("button",{type:"button",class:"btn btn-sm btn-secondary",onClick:d[0]||(d[0]=a=>c.openManageModal("delAll"))}," 刪除所有訂單 ")]),e("table",ze,[Xe,(r(!0),i(m,null,v(n.ordersData,a=>(r(),i("tbody",{key:a.id,class:"align-middle fs-6"},[e("tr",{class:S({"text-secondary":a.state===n.orderState[3]})},[e("td",null,s(a.num),1),e("td",null,[e("div",Ge,[O(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${a.id}`,"onUpdate:modelValue":_=>a.isRead=_,onChange:_=>c.toggleOrderIsRead(a)},null,40,He),[[p,a.isRead]]),e("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[a.isRead?(r(),i("span",Ke,"已讀取")):(r(),i("span",Qe,"未讀取"))],8,Ie)])]),e("td",null,s(a.orderDate),1),e("td",null,s(a.id),1),e("td",null,s(a.total),1),e("td",null,s(a.is_paid?"已付款":"未付款"),1),e("td",{class:S({"text-danger":a.state===n.orderState[0]})},s(a.state),3),e("td",null,s(a.isDelivery?"已出貨":"備貨中"),1),e("td",null,[e("button",{type:"button ",class:"btn btn-sm px-1",onClick:_=>c.openManageModal("edit",a)},et,8,We),e("button",{type:"button ",class:"btn btn-sm px-1",onClick:_=>c.openManageModal("del",a)},st,8,tt)])],2)]))),128))]),f(o,{ref:"pagination",pages:n.pagination,"get-per-page-data":c.getOrdersData},null,8,["pages","get-per-page-data"])])):n.haveOrdersData?u("",!0):(r(),i("div",lt,ot)),f(M,{ref:"delOrderModal","is-Del-All-Order":n.isDelAllOrder,"order-Selected":n.orderSelected,"del-Order":c.delOrder,"del-All-Orders":c.delAllOrders},null,8,["is-Del-All-Order","order-Selected","del-Order","del-All-Orders"]),f(k,{ref:"editOrderModal","order-Selected":n.orderSelected,"save-Order":c.saveOrder,"order-State":n.orderState},null,8,["order-Selected","save-Order","order-State"])],64)}const St=y(Je,[["render",rt]]);export{St as default};
