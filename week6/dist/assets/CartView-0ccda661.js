import{M}from"./bootstrap-c60aad6a.js";import{_ as w}from"./index-5d8ccf7f.js";import{l as c,x as h,y as t,D as l,B as v,F as D,C as $,H as g,k as b,z as u,A as L,I as x,J as I,E as p}from"./@vue-26db76b7.js";import"./axios-08622986.js";import"./vue-axios-58a7c26f.js";import"./@fortawesome-076f127c.js";import"./vee-validate-b6132790.js";import"./@vee-validate-55db0f47.js";import"./vue-router-58c0efe5.js";const O={props:["productSelected"],data(){return{modal:""}},mounted(){this.modal=new M(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}}},P={ref:"modal",class:"modal fade",id:"productInfoModal",tabindex:"-1","aria-labelledby":"productInfoModal","aria-hidden":"true"},F={class:"modal-dialog modal-dialog-centered modal-lg"},E={class:"modal-content"},A={class:"modal-header"},T={class:"modal-title fs-5",id:"exampleModalLabel"},q=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},B={class:"container"},N={class:"row"},R=["src","alt"],z=t("span",{class:"fs-6"},"商品名稱：",-1),H={class:"list-unstyled"},Q={class:"text-decoration-line-through fw-light"},J={class:"my-3"},G=t("hr",null,null,-1),K=t("span",null,"美味說明：",-1),W={class:"col-sm-3 me-3"},X=["src","alt"],Y=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 關閉 ")],-1);function Z(o,e,s,_,a,i){var n,m;return c(),h("div",P,[t("div",F,[t("div",E,[t("div",A,[t("h1",T," 商品細節："+l(s.productSelected.title),1),q]),t("div",j,[t("div",B,[t("div",N,[t("img",{src:s.productSelected.imageUrl,class:"rounded img-fluid object-fit-cover",alt:s.productSelected.title,style:{height:"50vh"}},null,8,R)]),t("h3",null,[z,v(l(s.productSelected.title),1)]),t("ul",H,[t("li",null,"菜式風格："+l(s.productSelected.category),1),t("li",null,"地域風味："+l(s.productSelected.areaCategory),1),t("li",null,"食材主題："+l(s.productSelected.ingredientCategory),1),t("li",null,"份量單位："+l(s.productSelected.unit),1),t("li",null,"內容物："+l(s.productSelected.description),1),t("li",Q," 原價："+l(s.productSelected.origin_price)+"元 ",1),t("li",null,"售價："+l(s.productSelected.price)+"元",1)]),t("div",J,[G,t("p",null,[K,v(l(s.productSelected.content),1)])]),Array.isArray((n=s.productSelected)==null?void 0:n.imagesUrl)&&((m=s.productSelected)!=null&&m.imagesUrl.length)?(c(!0),h(D,{key:0},$(s.productSelected.imagesUrl,f=>(c(),h("div",{class:"row my-3",key:"side-image"+f},[t("div",W,[t("img",{src:f,class:"rounded img-fluid object-fit-cover",alt:s.productSelected.title,style:{height:"20vh"}},null,8,X)])]))),128)):g("",!0)])]),Y])])],512)}const tt=w(O,[["render",Z]]),et={props:["orderData","payOrder"],data(){return{modal:""}},mounted(){this.modal=new M(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}}},st={ref:"modal",class:"modal fade",id:"orderInfoModal",tabindex:"-1","aria-labelledby":"orderInfoModal","aria-hidden":"true"},ot={class:"modal-dialog modal-dialog-centered modal-lg"},at={class:"modal-content"},lt={class:"modal-header"},dt={class:"modal-title fs-5",id:"exampleModalLabel"},rt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),it={class:"modal-body"},nt={class:"container"},ct={class:"row"},ht={class:"list-unstyled"},ut={class:"row my-3"},_t={class:"col-md-6"},mt=t("h6",null,"訂購明細",-1),bt={class:"card"},gt={class:"card-body"},ft={class:"table align-middle"},pt=t("thead",null,[t("tr",null,[t("th",null,"品名"),t("th",null,"數量"),t("th",null,"小計")])],-1),yt={class:"col-md-6 mf-3"},vt=t("h6",null,"訂購者資訊",-1),Dt={class:"card"},Ct={class:"card-body"},kt={class:"table align-middle"},wt=t("th",{scope:"row"},"姓名",-1),$t=t("th",{scope:"row"},"Email",-1),xt=t("th",{scope:"row"},"電話",-1),It=t("th",{scope:"row"},"地址",-1),St=t("th",{scope:"row"},"備註",-1),Mt={class:"modal-footer"},Vt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 確認訂單 ",-1),Ut=["disabled"];function Lt(o,e,s,_,a,i){return c(),h("div",st,[t("div",ot,[t("div",at,[t("div",lt,[t("h1",dt," 訂單明細："+l(s.orderData.id),1),rt]),t("div",it,[t("div",nt,[t("div",ct,[t("ul",ht,[t("li",null,"訂單編號："+l(s.orderData.id),1),t("li",null,"成立時間："+l(s.orderData.orderDate),1),t("li",null,"訂單金額："+l(s.orderData.total),1),t("li",null,"付款狀態："+l(s.orderData.is_paid?"已付款":"未付款"),1)])]),t("div",ut,[t("div",_t,[mt,t("div",bt,[t("div",gt,[t("table",ft,[pt,t("tbody",null,[(c(!0),h(D,null,$(s.orderData.productsData,n=>(c(),h("tr",{key:"orderProducts"+n.id},[t("td",null,l(n.product.title),1),t("td",null,l(n.qty),1),t("td",null,l(n.total),1)]))),128))])])])])]),t("div",yt,[vt,t("div",Dt,[t("div",Ct,[t("table",kt,[t("tbody",null,[t("tr",null,[wt,t("td",null,l(s.orderData.user.name),1)]),t("tr",null,[$t,t("td",null,l(s.orderData.user.email),1)]),t("tr",null,[xt,t("td",null,l(s.orderData.user.tel),1)]),t("tr",null,[It,t("td",null,l(s.orderData.user.address),1)]),t("tr",null,[St,t("td",null,l(s.orderData.user.message?s.orderData.user.message:"無備註"),1)])])])])])])])])]),t("div",Mt,[Vt,t("button",{type:"button",class:"btn btn-warning",onClick:e[0]||(e[0]=n=>s.payOrder(s.orderData.id)),disabled:s.orderData.is_paid},l(s.orderData.is_paid?"已完成付款":"付款"),9,Ut)])])])],512)}const Ot=w(et,[["render",Lt]]),{VITE_API_URL:C,VITE_API_PATH:k}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_API_PATH:"kimi_project",BASE_URL:"/vue3-ECPlatform/week6/dist/",MODE:"production",DEV:!1,PROD:!0},y=`${C}/api/${k}/cart`,Pt=`${C}/api/${k}/product`,S=`${C}/api/${k}/order`,Ft=`${C}/api/${k}/pay`,Et={data(){return{productSelected:"",loadingItem:"",isLoading:!1,cartData:[],cartTotalPrice:0,isCheckout:!1,orderFormData:{user:{name:"",email:"",tel:"",address:""},message:""},orderData:{user:""}}},methods:{getCartData(){this.cartTotalPrice=0,this.$http.get(y).then(o=>{this.isLoading=!1,this.cartData=o.data.data.carts,this.cartData.forEach(e=>{this.cartTotalPrice+=e.total})}).catch(o=>alert(o.response.data.message))},getProductInfo(o){this.isLoading=!0,this.$http.get(`${Pt}/${o}`).then(e=>{this.productSelected=e.data.product,this.isLoading=!1,this.$refs.userProductModal.openModal()}).catch(e=>alert(e.response.data.message))},checkCartItemQty(o){const e=this.cartData.findIndex(s=>s.product.id===o);if(e<0||this.cartData[e].qty<=10)return o;alert("選購數量已超過上限，若有大量採購需求請另洽")},adjustCartItem(o){const e=this.checkCartItemQty(o.product.id);if(!e)return;const s={product_id:e,qty:o.qty};this.loadingItem=e,this.isLoading=!0,this.$http.put(`${y}/${o.id}`,{data:s}).then(_=>{alert(_.data.message),this.loadingItem="",this.getCartData()}).catch(_=>alert(_.message))},delCartItem(o){this.isLoading=!0,this.$http.delete(`${y}/${o.id}`).then(e=>{alert(e.data.message),this.getCartData()}).catch(e=>alert(e.message))},delCartAll(){this.isLoading=!0;const o=`${y}s`;this.$http.delete(o).then(e=>{alert(e.data.message),this.getCartData()}).catch(e=>alert(e.message))},toggleCartState(o){if(o==="send")return this.isCheckout=!0;o==="cancel"&&(this.clickOrderFormData(),this.isCheckout=!1)},clickOrderFormData(){this.orderFormData.message="",Object.keys(this.orderFormData.user).forEach(o=>{this.orderFormData.user[o]=""})},sendOrder(o){this.isLoading=!0,this.$http.post(S,{data:o}).then(e=>{this.isLoading=!1,alert(e.data.message),this.cartData=[],this.getCartData(),this.clickOrderFormData(),this.isCheckout=!1,this.isLoading=!0,this.getOrderInfo(e.data.orderId)}).catch(e=>alert(e.message))},getOrderInfo(o){this.$http.get(`${S}/${o}`).then(e=>{this.isLoading=!1;const _=new Date(e.data.order.create_at*1e3).toLocaleString().split(" ")[0],a=[];Object.keys(e.data.order.products).forEach(i=>{a.push(e.data.order.products[i])}),this.orderData={...e.data.order,orderDate:_,productsData:a},this.$refs.orderInfoModal.openModal()}).catch(e=>alert(e.message))},payOrder(o){this.isLoading=!0,this.$http.post(`${Ft}/${o}`).then(e=>{this.isLoading=!1,alert(e.data.message),this.getOrderInfo(o)}).catch(e=>alert(e.response.data.message))}},components:{UserProductModal:tt,OrderInfoModal:Ot},mounted(){this.getCartData()}},At={class:"main"},Tt={class:"row"},qt={class:"col-6 p-3"},jt=t("h4",null,"我的菜籃車",-1),Bt={class:"card my-4"},Nt={key:0,class:"position-absolute text-white d-flex align-items-center justify-content-center active",style:{top:"0",bottom:"0",left:"0",right:"0","background-color":"rgba(0, 0, 0, 0.65)","z-index":"100"}},Rt={class:"card-body"},zt={class:"table text-center"},Ht=t("thead",null,[t("tr",null,[t("th",{width:"100"},"品名"),t("th",{width:"50"},"單價"),t("th",{width:"100"},"數量"),t("th",{width:"70"},"小計"),t("th",{width:"20"}),t("th",{width:"20"})])],-1),Qt={key:0,class:"align-middle"},Jt={class:"fw-light"},Gt={class:"fw-light"},Kt={class:"fw-light"},Wt=["onUpdate:modelValue","onChange","disabled"],Xt={class:"fw-light"},Yt={class:"px-0"},Zt=["onClick","disabled"],te=t("i",{class:"fa-solid fa-eye fw-light text-secondary"},null,-1),ee=[te],se={class:"px-0"},oe=["onClick","disabled"],ae=t("i",{class:"fa-regular fa-trash-can text-danger fw-light"},null,-1),le=[ae],de={key:0},re={class:"text-end"},ie={class:"fw-bold"},ne={class:"d-flex gap-2 mt-3"},ce=["disabled"],he=["disabled"],ue={key:0,class:"col-6 p-3"},_e=t("h4",null,"訂購者資訊",-1),me={class:"card my-3"},be={class:"card-body"},ge={class:"mb-3"},fe=t("label",{for:"name",class:"form-label"},"姓名：",-1),pe={class:"mb-3"},ye=t("label",{for:"email",class:"form-label"},"E-mail：",-1),ve={class:"mb-3"},De=t("label",{for:"tel",class:"form-label"},"電話：",-1),Ce={class:"mb-3"},ke=t("label",{for:"address",class:"form-label"},"收件地址：",-1),we={class:"mb-3"},$e=t("label",{for:"message",class:"form-label"},"備註：",-1),xe={class:"d-flex gap-2 mt-3"},Ie=["disabled"];function Se(o,e,s,_,a,i){const n=b("v-field"),m=b("error-message"),f=b("v-form"),V=b("UserProductModal"),U=b("OrderInfoModal");return c(),h(D,null,[t("div",At,[t("div",Tt,[t("div",qt,[jt,t("div",Bt,[a.cartData.length?g("",!0):(c(),h("div",Nt," 請先選購商品 ")),t("div",Rt,[t("table",zt,[Ht,a.cartData.length>0?(c(),h("tbody",Qt,[(c(!0),h(D,null,$(a.cartData,d=>(c(),h("tr",{key:"cartItem"+d.id},[t("th",Jt,l(d.product.title),1),t("th",Gt,l(d.product.price),1),t("th",Kt,[x(t("input",{id:"qty","onUpdate:modelValue":r=>d.qty=r,type:"number",min:"1",max:"10",class:"form-control",onChange:r=>i.adjustCartItem(d),disabled:a.loadingItem===d.product.id||a.isCheckout},null,40,Wt),[[I,d.qty,void 0,{number:!0}]])]),t("th",Xt,l(d.total),1),t("th",Yt,[t("button",{type:"button ",class:"btn btn-sm px-1",onClick:r=>i.getProductInfo(d.product.id),disabled:a.isCheckout},ee,8,Zt)]),t("th",se,[t("button",{type:"button",class:"btn btn-sm px-1 m-0",onClick:r=>i.delCartItem(d),disabled:a.isCheckout},le,8,oe)])]))),128))])):g("",!0)]),a.cartData.length>0?(c(),h("div",de,[t("p",re,[v(" 總金額： NT$ "),t("span",ie,l(a.cartTotalPrice),1),v("元 ")]),t("div",ne,[t("button",{class:"btn btn-outline-secondary w-100",type:"button",onClick:e[0]||(e[0]=(...d)=>i.delCartAll&&i.delCartAll(...d)),disabled:a.isCheckout}," 刪除所有品項 ",8,ce),t("button",{class:"btn btn-warning w-100",type:"button",onClick:e[1]||(e[1]=d=>i.toggleCartState("send")),disabled:a.isCheckout}," 前往結帳 ",8,he)])])):g("",!0)])])]),a.isCheckout?(c(),h("div",ue,[_e,t("div",me,[t("div",be,[u(f,{onSubmit:e[8]||(e[8]=d=>i.sendOrder(a.orderFormData))},{default:L(({errors:d})=>[t("div",ge,[fe,u(n,{id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":d.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:a.orderFormData.user.name,"onUpdate:modelValue":e[2]||(e[2]=r=>a.orderFormData.user.name=r)},null,8,["class","modelValue"]),u(m,{name:"姓名",class:"invalid-feedback"})]),t("div",pe,[ye,u(n,{id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":d.email}]),placeholder:"請輸入Email",rules:"required|email",modelValue:a.orderFormData.user.email,"onUpdate:modelValue":e[3]||(e[3]=r=>a.orderFormData.user.email=r)},null,8,["class","modelValue"]),u(m,{name:"email",class:"invalid-feedback"})]),t("div",ve,[De,u(n,{id:"tel",name:"電話",type:"tel",class:p(["form-control",{"is-invalid":d.電話}]),placeholder:"請輸入電話",rules:"numeric|required|min:8|max:10",modelValue:a.orderFormData.user.tel,"onUpdate:modelValue":e[4]||(e[4]=r=>a.orderFormData.user.tel=r)},null,8,["class","modelValue"]),u(m,{name:"電話",class:"invalid-feedback"})]),t("div",Ce,[ke,u(n,{id:"address",name:"收件地址",type:"text",class:p(["form-control",{"is-invalid":d.收件地址}]),placeholder:"請輸入收件地址",rules:"required",modelValue:a.orderFormData.user.address,"onUpdate:modelValue":e[5]||(e[5]=r=>a.orderFormData.user.address=r)},null,8,["class","modelValue"]),u(m,{name:"收件地址",class:"invalid-feedback"})]),t("div",we,[$e,x(t("textarea",{id:"message",type:"text",placeholder:"請輸入備註",class:"form-control",cols:"10",rows:"5","onUpdate:modelValue":e[6]||(e[6]=r=>a.orderFormData.user.message=r)},`
                `,512),[[I,a.orderFormData.user.message]])]),t("div",xe,[t("button",{class:"btn btn-outline-secondary w-100",type:"button",onClick:e[7]||(e[7]=r=>i.toggleCartState("cancel"))}," 取消結帳 "),t("button",{class:"btn btn-warning w-100",type:"submit",disabled:a.isLoading}," 送出訂單 ",8,Ie)])]),_:1})])])])):g("",!0)])]),u(V,{ref:"userProductModal","product-Selected":a.productSelected},null,8,["product-Selected"]),u(U,{ref:"orderInfoModal","order-Data":a.orderData,"pay-Order":i.payOrder},null,8,["order-Data","pay-Order"])],64)}const Te=w(Et,[["render",Se]]);export{Te as default};
